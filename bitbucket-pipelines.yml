image: python:3.8
pipelines:
  branches:
    master: &shared
      - step:
          name: upload library to jfrog
          script:
            - git submodule update --init --recursive
            - apt update && apt -y install cmake
            - printf "[distutils]\n" >> ~/.pypirc
            - printf "index-servers=splightlib\n" >> ~/.pypirc
            - printf "[splightlib]\n" >> ~/.pypirc
            - printf "repository:https://splight.jfrog.io/artifactory/api/pypi/splight-local\n" >> ~/.pypirc
            - printf "username=$JFROG_BOT_USERNAME\n" >> ~/.pypirc
            - printf "password=$JFROG_BOT_PASS\n" >> ~/.pypirc
            - python setup.py bdist_wheel upload -r splightlib
            - rm ~/.pypirc;
    main: *shared
